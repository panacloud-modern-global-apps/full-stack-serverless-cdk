import{r as t,h as i}from"./p-8fb49ffc.js";import{Logger as r,filenameToContentType as e,I18n as s}from"@aws-amplify/core";import{A as o}from"./p-f199eef0.js";import"@aws-amplify/auth";import{T as a}from"./p-915bcfdd.js";import{e as n}from"./p-2915ed18.js";import{Storage as m}from"@aws-amplify/storage";import{i as p,c as h,p as l}from"./p-0f1a94bf.js";var c,f=new Uint8Array(16);function d(){if(!c&&!(c="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return c(f)}const y=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function u(t){return"string"==typeof t&&y.test(t)}for(var g=[],b=0;b<256;++b)g.push((b+256).toString(16).substr(1));function v(t,i,r){var e=(t=t||{}).random||(t.rng||d)();if(e[6]=15&e[6]|64,e[8]=63&e[8]|128,i){r=r||0;for(var s=0;s<16;++s)i[r+s]=e[s];return i}return function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(g[t[i+0]]+g[t[i+1]]+g[t[i+2]]+g[t[i+3]]+"-"+g[t[i+4]]+g[t[i+5]]+"-"+g[t[i+6]]+g[t[i+7]]+"-"+g[t[i+8]]+g[t[i+9]]+"-"+g[t[i+10]]+g[t[i+11]]+g[t[i+12]]+g[t[i+13]]+g[t[i+14]]+g[t[i+15]]).toLowerCase();if(!u(r))throw TypeError("Stringified UUID is invalid");return r}(e)}const w=new r("S3Album"),x=class{constructor(i){t(this,i),this.contentType="binary/octet-stream",this.level=o.Public,this.picker=!0,this.pickerText=a.PICKER_TEXT,this.albumItems=[],this.imgArr={},this.list=async()=>{const{path:t="",level:i,track:r,identityId:e}=this;if(w.debug("Album path: "+t),!m||"function"!=typeof m.list)throw new Error(n);try{const s=await m.list(t,{level:i,track:r,identityId:e});this.marshal(s)}catch(s){w.warn(s)}},this.marshal=t=>{t.forEach(t=>{const i=t.key.toLowerCase().split(".")[1];p.has(i)&&(!t.contentType||t.contentType&&"binary/octet-stream"===t.contentType)&&(t.contentType=this.getContentType(t))});const i=t.filter(t=>t.contentType&&t.contentType.startsWith("image/"));let r=this.filter?this.filter(i):i;r=this.sort?this.sort(r):r,this.albumItems=r,w.debug("album items",this.albumItems),this.constructImgArray(this.albumItems)},this.constructImgArray=t=>{t.map(t=>{this.imgArr[""+t.key]=t.key})},this.handlePick=async t=>{const i=t.target.files[0],{path:r="",level:e,track:s,fileToKey:o}=this,a=r+h(i,o);try{await l(a,i,e,s,i.type,w)}catch(n){throw w.error(n),new Error(n)}if(Object.keys(this.imgArr).includes(a))this.albumItems=[...this.albumItems],this.imgArr[a]=`${a}-${v()}`;else{const t=[...this.albumItems,...this.filter?this.filter([{key:a}]):[{key:a}]];this.albumItems=this.sort?this.sort(t):t}}}getContentType(t){return e(t.key,"image/*")}componentWillLoad(){this.list()}render(){return i("div",null,i("div",{class:"album-container"},i("div",{class:"grid-row"},this.albumItems.map(t=>i("div",{class:"grid-item",key:"key-"+t.key},i("amplify-s3-image",{key:this.imgArr[t.key],imgKey:t.key,level:this.level,path:this.path,identityId:this.identityId,track:this.track,handleOnError:this.handleOnError,handleOnLoad:this.handleOnLoad}),i("span",{class:"img-overlay"}))))),this.picker&&i("amplify-picker",{pickerText:s.get(this.pickerText),inputHandler:t=>this.handlePick(t),acceptValue:"image/*"}))}};x.style=":host{--overlay-bg-color:rgba(0, 0, 0, 0.15)}.album-container{-webkit-box-sizing:border-box;box-sizing:border-box;max-width:100%;margin:0 auto;padding:0 2rem}.grid-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:-1rem -1rem;padding-bottom:3rem}.grid-item{position:relative;-ms-flex:1 0 22rem;flex:1 0 22rem;-ms-flex-positive:1;flex-grow:1;margin:1rem;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}amplify-s3-image{--width:22rem;--height:20rem;border-radius:5px;-o-object-fit:cover;object-fit:cover}.img-overlay{display:none;width:100%;height:21rem;position:absolute;top:0;left:0;background-color:var(--overlay-bg-color)}.grid-item:hover .img-overlay{display:block}";export{x as amplify_s3_album}