import{r as t,h as o}from"./p-8fb49ffc.js";import{ConsoleLogger as i,I18n as n}from"@aws-amplify/core";import{A as e}from"./p-417bb5ea.js";import{Auth as s}from"@aws-amplify/auth";import{T as a}from"./p-915bcfdd.js";import{N as r,j as c}from"./p-2915ed18.js";import{d as h}from"./p-b7cf913b.js";const l=new i("amplify-amazon-button"),u=class{constructor(o){t(this,o),this.handleAuthStateChange=h,this.federatedSignIn=t=>{const{access_token:o,expires_in:i}=t;if(!o)return;if(!s||"function"!=typeof s.federatedSignIn||"function"!=typeof s.currentAuthenticatedUser)throw new Error(r);const n=1e3*i+(new Date).getTime();window.amazon.Login.retrieveProfile(async t=>{if(!t.success)return l.debug("Get user Info failed");const i={name:t.profile.Name,email:t.profile.PrimaryEmail};await s.federatedSignIn("amazon",{token:o,expires_at:n},i);const a=await s.currentAuthenticatedUser();this.handleAuthStateChange(e.SignedIn,a)})}}signInWithAmazon(t){t.preventDefault(),window.amazon.Login.setClientId(this.clientId),window.amazon.Login.authorize({scope:"profile"},t=>{if(t.error)return l.debug("Failed to login with amazon: "+t.error);try{window.localStorage.setItem(c,JSON.stringify({provider:"amazon"}))}catch(o){l.debug("Failed to cache auth source into localStorage",o)}this.federatedSignIn(t)})}render(){return o("amplify-sign-in-button",{onClick:t=>this.signInWithAmazon(t),provider:"amazon"},o("script",{src:"https://assets.loginwithamazon.com/sdk/na/login1.js"}),n.get(a.SIGN_IN_WITH_AMAZON))}},p=new i("amplify-auth0-button"),f=class{constructor(o){t(this,o),this.handleAuthStateChange=h,this.handleLoad=()=>{const{oauth:t={}}=s.configure(),{config:o=t.auth0}=this;o?(p.debug("auth0 configuration",o),this._auth0||(this._auth0=new window.auth0.WebAuth(o)),this._auth0.parseHash((t,i)=>{if(t)return void p.debug("Failed to parse the url for Auth0",t);if(!i)return void p.debug("Auth0 found no authResult in hash");const n={provider:"auth0",opts:{returnTo:o.returnTo,clientID:o.clientID,federated:o.federated}};try{localStorage.setItem(c,JSON.stringify(n))}catch(a){p.debug("Failed to cache auth source into localStorage",a)}this._auth0.client.userInfo(i.accessToken,async(t,n)=>{let a=void 0,r=void 0;t?p.debug("Failed to get the user info",t):(a=n.name,r=n.email),await s.federatedSignIn(o.domain,{token:i.idToken,expires_at:1e3*i.expiresIn+(new Date).getTime()},{name:a,email:r});const c=await s.currentAuthenticatedUser();this.handleAuthStateChange(e.SignedIn,c)})})):p.debug("Auth0 is not configured")}}signInWithAuth0(t){if(t.preventDefault(),!this._auth0)throw new Error("the auth0 client is not configured");this._auth0.authorize()}render(){return o("amplify-sign-in-button",{onClick:t=>this.signInWithAuth0(t),provider:"auth0"},o("script",{onLoad:this.handleLoad,src:"https://cdn.auth0.com/js/auth0/9.11/auth0.min.js"}),n.get(a.SIGN_IN_WITH_AUTH0))}},d=new i("amplify-facebook-button"),w=class{constructor(o){t(this,o),this.handleAuthStateChange=h,this.federatedSignIn=t=>{const{accessToken:o,expiresIn:i}=t;if(!o)return;if(!s||"function"!=typeof s.federatedSignIn||"function"!=typeof s.currentAuthenticatedUser)throw new Error(r);const n=1e3*i+(new Date).getTime();window.FB.api("/me",{fields:"name,email"},async t=>{const i={name:t.name,email:t.email};await s.federatedSignIn("facebook",{token:o,expires_at:n},i);const a=await s.currentAuthenticatedUser();this.handleAuthStateChange(e.SignedIn,a)})},this.getLoginStatus=()=>{window.FB.getLoginStatus(t=>{try{window.localStorage.setItem(c,JSON.stringify({provider:"facebook"}))}catch(o){d.debug("Failed to cache auth source into localStorage",o)}if("connected"===t.status)return this.federatedSignIn(t.authResponse);this.login()})},this.login=()=>{window.FB.login(t=>{t&&t.authResponse&&this.federatedSignIn(t.authResponse)},{scope:"public_profile,email"})}}signInWithFacebook(t){t.preventDefault(),window.FB.init({appId:this.appId,cookie:!0,xfbml:!1,version:"v5.0"}),this.getLoginStatus()}render(){return o("amplify-sign-in-button",{onClick:t=>this.signInWithFacebook(t),provider:"facebook"},o("script",{async:!0,defer:!0,src:"https://connect.facebook.net/en_US/sdk.js"}),n.get(a.SIGN_IN_WITH_FACEBOOK))}},m=new i("amplify-google-button"),g=class{constructor(o){t(this,o),this.handleAuthStateChange=h,this.handleError=t=>{console.error(t)},this.handleLoad=()=>{window.gapi.load("auth2")},this.handleUser=async t=>{if(!s||"function"!=typeof s.federatedSignIn||"function"!=typeof s.currentAuthenticatedUser)throw new Error(r);try{window.localStorage.setItem(c,JSON.stringify({provider:"google"}))}catch(h){m.debug("Failed to cache auth source into localStorage",h)}const{id_token:o,expires_at:i}=t.getAuthResponse(),n=t.getBasicProfile();await s.federatedSignIn("google",{token:o,expires_at:i},{email:n.getEmail(),name:n.getName(),picture:n.getImageUrl()});const a=await s.currentAuthenticatedUser();try{this.handleAuthStateChange(e.SignedIn,a)}catch(l){this.handleError(l)}}}getAuthInstance(){return window.gapi&&window.gapi.auth2?window.gapi.auth2.getAuthInstance()||window.gapi.auth2.init({client_id:this.clientId,cookiepolicy:"single_host_origin",scope:"profile email openid"}):null}signInWithGoogle(t){t.preventDefault(),this.getAuthInstance().signIn().then(this.handleUser).catch(this.handleError)}render(){return o("amplify-sign-in-button",{onClick:t=>this.signInWithGoogle(t),provider:"google"},o("script",{onLoad:this.handleLoad,src:"https://apis.google.com/js/api:client.js"}),n.get(a.SIGN_IN_WITH_GOOGLE))}},y=class{constructor(o){t(this,o),this.config={}}signInWithOAuth(t){t.preventDefault(),s.federatedSignIn()}render(){return o("amplify-sign-in-button",{onClick:t=>this.signInWithOAuth(t),provider:"oauth"},this.config.label||n.get(a.SIGN_IN_WITH_AWS))}};export{u as amplify_amazon_button,f as amplify_auth0_button,w as amplify_facebook_button,g as amplify_google_button,y as amplify_oauth_button}